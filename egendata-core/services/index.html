<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.58.3" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="//egendata.github.io/docs/images/egendata.png" type="image/x-icon" />
    <title>Services :: My New Hugo Site</title>

    
    <link href="/docs/css/nucleus.css?1595422087" rel="stylesheet">
    <link href="/docs/css/fontawesome-all.min.css?1595422087" rel="stylesheet">
    <link href="/docs/css/hybrid.css?1595422087" rel="stylesheet">
    <link href="/docs/css/featherlight.min.css?1595422087" rel="stylesheet">
    <link href="/docs/css/perfect-scrollbar.min.css?1595422087" rel="stylesheet">
    <link href="/docs/css/auto-complete.css?1595422087" rel="stylesheet">
    <link href="/docs/css/atom-one-dark-reasonable.css?1595422087" rel="stylesheet">
    <link href="/docs/css/theme.css?1595422087" rel="stylesheet">
    <link href="/docs/css/hugo-theme.css?1595422087" rel="stylesheet">
    
      <link href="/docs/css/theme-mine.css?1595422087" rel="stylesheet">
    

    <script src="/docs/js/jquery-3.3.1.min.js?1595422087"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/docs/egendata-core/services/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="//egendata.github.io/docs">
  <img alt="Egendata" src="//egendata.github.io/docs/images/egendata.png" />
</a>
    </div>
    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/docs/architecture/" title="Architecture" class="dd-item 
        
        
        
        ">
      <a href="/docs/architecture/">
          Architecture
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/cryptography/" title="Cryptography" class="dd-item 
        
        
        
        ">
      <a href="/docs/cryptography/">
          Cryptography
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/egendata-core/" title="Egendata Core" class="dd-item 
        parent
        
        
        ">
      <a href="/docs/egendata-core/">
          Egendata Core
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docs/egendata-core/client/" title="Client" class="dd-item 
        
        
        
        ">
      <a href="/docs/egendata-core/client/">
          Client
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/egendata-core/data/" title="Data" class="dd-item 
        
        
        
        ">
      <a href="/docs/egendata-core/data/">
          Data
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/egendata-core/security/" title="Security" class="dd-item 
        
        
        
        ">
      <a href="/docs/egendata-core/security/">
          Security
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/egendata-core/services/" title="Services" class="dd-item 
        parent
        active
        
        ">
      <a href="/docs/egendata-core/services/">
          Services
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/infrastructure/" title="Infrastructure" class="dd-item 
        
        
        
        ">
      <a href="/docs/infrastructure/">
          Infrastructure
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docs/infrastructure/cli/" title="cli" class="dd-item 
        
        
        
        ">
      <a href="/docs/infrastructure/cli/">
          cli
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/infrastructure/client/" title="client" class="dd-item 
        
        
        
        ">
      <a href="/docs/infrastructure/client/">
          client
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/infrastructure/example-cv/" title="Example-CV" class="dd-item 
        
        
        
        ">
      <a href="/docs/infrastructure/example-cv/">
          Example-CV
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/infrastructure/example-national-registration/" title="Example-National-Registration" class="dd-item 
        
        
        
        ">
      <a href="/docs/infrastructure/example-national-registration/">
          Example-National-Registration
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/infrastructure/messaging/" title="messaging" class="dd-item 
        
        
        
        ">
      <a href="/docs/infrastructure/messaging/">
          messaging
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/infrastructure/operator/" title="Operator" class="dd-item 
        
        
        
        ">
      <a href="/docs/infrastructure/operator/">
          Operator
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docs/infrastructure/react-native-simple-crypto/" title="react-native-simple-crypto" class="dd-item 
        
        
        
        ">
      <a href="/docs/infrastructure/react-native-simple-crypto/">
          react-native-simple-crypto
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/phone-app/" title="Mobile App" class="dd-item 
        
        
        
        ">
      <a href="/docs/phone-app/">
          Mobile App
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/operator/" title="Operator" class="dd-item 
        
        
        
        ">
      <a href="/docs/operator/">
          Operator
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/docs/'>Introduction</a> > <a href='/docs/egendata-core/'>Egendata Core</a> > Services
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#read-from-pds-via-operator">Read from PDS via Operator</a>
<ul>
<li><a href="#sending-the-read-request">Sending the read request</a></li>
<li><a href="#handling-the-read-response">Handling the read response</a></li>
</ul></li>
<li><a href="#write-to-pds-via-operator">Write to PDS via Operator</a>
<ul>
<li><a href="#sending-the-write-request">Sending the write request</a></li>
<li><a href="#handling-the-write-response">Handling the write response</a></li>
</ul></li>
<li><a href="#flöde">Flöde</a>
<ul>
<li><a href="#för-användaren">För användaren</a></li>
<li><a href="#så-här-går-det-till-i-bakgrunden">Så här går det till i bakgrunden</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Services
            </h1>
          

        




	

<h2 id="read-from-pds-via-operator">Read from PDS via Operator</h2>

<h3 id="sending-the-read-request">Sending the read request</h3>

<ol>
<li>The Service constructs a JWT message (&ldquo;DATA_READ_REQUEST&rdquo;) with desired &ldquo;content paths&rdquo; and a connectionId(sub).</li>
<li>The message(JWT) is transmitted to the Operator.</li>
</ol>

<h3 id="handling-the-read-response">Handling the read response</h3>

<ol>
<li>The service receives the incoming message(JWT) and iterates through all listed &ldquo;content paths&rdquo;

<ol>
<li>The Service inspects the JWE and locates its own &ldquo;Recipient&rdquo; key.</li>
<li>The Service obtains the required decryption key for the encrypted data, through decrypting its own &ldquo;Recipient&rdquo; entry with it&rsquo;s own private key.</li>
<li>The JWE is then decrypted with the decryption key.</li>
</ol></li>
<li>All &ldquo;content paths&rdquo; are returned with decrypted data, alternatively error if something went wrong in the previous step.</li>
</ol>

<p>:warning: Ask/Check if the Service&rsquo;s received message contains all intended Recipients or just a single one.</p>

<h2 id="write-to-pds-via-operator">Write to PDS via Operator</h2>

<h3 id="sending-the-write-request">Sending the write request</h3>

<ol>
<li>When a service wants to write to a user’s PDS, a JWT message of type &ldquo;DATA_WRITE&rdquo; is constructed with the following inputs are required: &ldquo;domain&rdquo;, &ldquo;area&rdquo; and optionally &ldquo;data&rdquo;(JWE). A &ldquo;DATA_WRITE&rdquo; without any data is essentially the same as clearing the data located at the “content path” of the user’s PDS.</li>
<li>First a signing key(JWK) is constructed based upon the &ldquo;domain&rdquo; and &ldquo;area&rdquo; (This is not fully implemented and instead the service&rsquo;s own private key(from the client configuration) is used).</li>
<li>The &ldquo;data&rdquo; is signed with the service&rsquo;s private key and represented as an JWS object.</li>
<li>A JWE is then constructed based upon the JWS and each read permissioned recipient.</li>
<li>Finally the JWE is packed into a JWT and transmitted over to the Operator.</li>
</ol>

<h3 id="handling-the-write-response">Handling the write response</h3>

<p>Placeholder</p>

<hr />

<p><strong>TODO: hur sätter man upp en tjänst. länka till repo för service</strong></p>

<h2 id="flöde">Flöde</h2>

<p>När en användare vill använda en tjänst sker det genom ett antal steg. Flera av dessa är osynliga för användaren och, om Tjänsten använder använder befintliga kodbibliotek, ingenting som Tjänstens systemutvecklare ser då de sker i bakgrunden. Flödet för anslutning till en tjänst, medgivande för dataläsning/-skrivning och uppdateringar beskrivs här översiktligt och på djupet (för den som är intresserad).</p>

<h3 id="för-användaren">För användaren</h3>

<ol>
<li><p>Användaren går in på en Tjänst och erbjuds registrera sig/logga in med Egendata. Detta sker genom att antingen scanna en QR-kod med Egendata-appen eller, om hen använder mobilen, klicka på en länk.</p></li>

<li><p>Egendata-appen frågar användaren om hen vill logga in om registrering redan har skett, eller skapa en relation med Tjänsten om detta är första besöket. Användaren får, i det senare fallet, även möjligheten att godkänna Tjänstens begäran om att läsa/skriva data.</p></li>

<li><p>När användaren har svarat, än hen inloggad på Tjänsten och kan börja använda den.</p></li>
</ol>

<h3 id="så-här-går-det-till-i-bakgrunden">Så här går det till i bakgrunden</h3>

<ol>
<li><p>Tjänsten presenterar en länk, vilken också kodas som en QR-kod. Länken beskriver tjänsten med id för tjänsten och ett sessionsid för att kunna koppla svaret till rätt användarsession. All information är signerad med tjänstens signeringsnyckel.</p></li>

<li><p>Egendata-appen kontaktar tjänsten och begär signeringsnyckeln. Den verifierar sedan informationen.</p></li>

<li><p>Egendata-appen kontrollerar om användaren och tjänsten redan har en relation eller om en sådan måste skapas.</p></li>
</ol>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/docs/egendata-core/security/" title="Security"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/docs/infrastructure/" title="Infrastructure" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docs/js/clipboard.min.js?1595422087"></script>
    <script src="/docs/js/perfect-scrollbar.min.js?1595422087"></script>
    <script src="/docs/js/perfect-scrollbar.jquery.min.js?1595422087"></script>
    <script src="/docs/js/jquery.sticky.js?1595422087"></script>
    <script src="/docs/js/featherlight.min.js?1595422087"></script>
    <script src="/docs/js/highlight.pack.js?1595422087"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docs/js/modernizr.custom-3.6.0.js?1595422087"></script>
    <script src="/docs/js/learn.js?1595422087"></script>
    <script src="/docs/js/hugo-learn.js?1595422087"></script>

    <link href="/docs/mermaid/mermaid.css?1595422087" rel="stylesheet" />
    <script src="/docs/mermaid/mermaid.js?1595422087"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
